!function(){function e(e,n){return e.filter(function(e){return e!==n})}function n(e){if(name=e.name.value,""!=name&&" "!=name&&"  "!=name&&"   "!=name){e.drawing&&(M[B]=e.drawing),g.push(B),h.push(B),h.push(B),h.push(B),C[B]=u(name),!m&&g.length>0&&($(".scoreboard").empty(),dateNow=new Date,a(),m=window.setInterval(t,1));var n="";e.drawing&&(n="<canvas id='canvas-"+B+"' class='player-icon' height=\""+M[B][3]+'" width="'+M[B][4]+'"></canvas>'),$(".scoreboard").append('<li id="score-'+B+'" title="Click to remove the player" class="score-element player-remove-name">'+n+'<span class="name">'+u(name)+'</span><span class="score">0</span></li>'),e.drawing&&(context=document.getElementById("canvas-"+B).getContext("2d"),r(M[B][0],M[B][1],M[B][2],M[B][5],!0,50)),N[B]={},N[B].id=B,N[B].score=0,N[B].html='<li id="score-'+B+'" title="Click to remove the player" class="score-element player-remove-name">'+n+'<span class="name">'+u(name)+'</span><span class="score">0</span></li>',B+=1,e.name.value=""}else alert("Please enter a name..")}function t(){if(curr=new Date,seconds=Math.floor((fDate-curr)/1e3)-60*Math.floor((fDate-curr)/1e3/60),minutes=Math.floor((fDate-curr)/1e3/60),milli=fDate-curr-1e3*seconds-60*minutes*1e3,0==minutes&&seconds<10||w?document.getElementById("display-area").style.cssText="visibility:visible;":minutes>0&&(document.getElementById("display-area").style.cssText="visibility:hidden;"),minutes<0&&(a(),rng=l(y?h:g),b=C[rng],document.getElementById("previous").innerHTML="Your turn to drink "+b+"!",lowerVolume(),responsiveVoice.speak("Your turn to drink "+b,"US English Male",{onend:o}),$("#canvas").remove(),M[rng]&&($("#container").append("<canvas id='canvas' style='-webkit-animation: animation-"+(I?"right":"left")+" "+60*v+"s linear infinite;animation: animation-"+(I?"right":"left")+" "+60*v+"s linear infinite;' height=\""+M[h[rng]][3]+'" width="'+M[h[rng]][4]+'"></canvas>'),I=!I,context=document.getElementById("canvas").getContext("2d"),r(M[rng][0],M[rng][1],M[rng][2],M[rng][5],!0,5)),N.find(function(e){return e.id===rng}).score+=1,N.sort(c({name:"score",reverse:!0})),s(N),y)){var e=h.indexOf(rng);if(h.splice(e,1),0==h.length)for(x in g)h.push(g[x]),h.push(g[x]),h.push(g[x])}document.getElementById("display-area").innerHTML=d(minutes,2)+":"+d(seconds,2)+"."+d(milli,3)}function o(){responsiveVoice.cancel(),resetVolume();var e=Math.floor(1e3*Math.random()+1);k&&(137==e?p.play():f.play()),H=0,setTimeout(i,1),setTimeout(function(){document.getElementById("previous").innerHTML="Previous drinker: "+b,H=7,k&&(137==e?(p.pause(),p.currentTime=0):(f.pause(),f.currentTime=0)),document.getElementById("container").style.background="rgba(255,255,255,0.95)"},1e4)}function a(){dateNow=new Date,$(".scoreboard-container").removeClass("hide"),$("#interval").prop("checked")?(v=parseInt($("#intervalnumber").val()),v<=0&&(v=1),fDate=new Date(dateNow.getYear()+1900,dateNow.getMonth(),dateNow.getDate(),dateNow.getHours(),dateNow.getMinutes()+v,dateNow.getSeconds(),dateNow.getMilliseconds())):(v=Math.floor(6*Math.random())+1,fDate=new Date(dateNow.getYear()+1900,dateNow.getMonth(),dateNow.getDate(),dateNow.getHours(),dateNow.getMinutes()+v,dateNow.getSeconds(),dateNow.getMilliseconds()))}function i(){H+=1,1==H&&(document.getElementById("container").style.backgroundColor="red",setTimeout(i,85)),2==H&&(document.getElementById("container").style.backgroundColor="blue",setTimeout(i,80)),3==H&&(document.getElementById("container").style.backgroundColor="purple",setTimeout(i,75)),4==H&&(document.getElementById("container").style.backgroundColor="yellow",setTimeout(i,75)),5==H&&(document.getElementById("container").style.backgroundColor="green",setTimeout(i,75)),6==H&&(H=0,setTimeout(i,1))}function r(e,n,t,o,a,i){if(context.strokeStyle=o,context.lineJoin="round",context.lineWidth=i,a)for(var r=0;r<e.length;r++)context.beginPath(),t[r]&&r?context.moveTo(e[r-1],n[r-1]):context.moveTo(e[r]-1,n[r]),context.lineTo(e[r],n[r]),context.closePath(),context.stroke();else context.beginPath(),t[t.length-1]?context.moveTo(e[t.length-2],n[t.length-2]):context.moveTo(e[t.length-1]-1,n[t.length-1]),context.lineTo(e[t.length-1],n[t.length-1]),context.closePath(),context.stroke()}function c(){for(var e,n,t,o=[],a=arguments.length,i=function(e,n){return e===n?0:e<n?-1:1},r=function(e,n){var t=i,o=i;return e&&(o=function(n,o){return t(e(n),e(o))}),n?function(e,n){return-1*o(e,n)}:o},c=0;c<a;c++)e=arguments[c],"string"==typeof e?(n=e,t=i):(n=e.name,t=r(e.primer,e.reverse)),o.push({name:n,cmp:t});return function(n,t){for(var i,r,c=0;c<a&&(r=0,e=o[c],i=e.name,0===(r=e.cmp(n[i],t[i])));c++);return r}}function s(e){$(".scoreboard").empty(),$.each(e,function(e,n){var t=$(n.html),o=n.score;t.find(".score").text(o);var a=t.find("canvas").attr("id");if($(".scoreboard").append(t),void 0!=a){var i=a.split("-")[1];context=document.getElementById("canvas-"+i).getContext("2d"),r(M[i][0],M[i][1],M[i][2],M[i][5],!0,50)}})}function l(e){return e[Math.floor(Math.random()*e.length)]}function d(e,n){return 2==n?out=e<10?"0"+e:e:3==n&&(out=e<10?"00"+e:e<100?"0"+e:e),out}function u(e){return e.charAt(0).toUpperCase()+e.slice(1)}var m,m,h=Array(),g=Array(),f=new Audio("sound/bell.mp3"),p=new Audio("sound/sanic.mp3"),v=0,w=!0,y=!0,b="",k=!0,T="",M={},I=!0,E=!0,C={},B=0,N=[],D=3001,L=io.connect(window.location.protocol+"//"+window.location.hostname+":"+D,{secure:window.location.protocol.indexOf("https")>-1});L.on("joined",function(e){n({name:{value:e._name},drawing:e._drawing})}),L.on("id",function(e){T=encodeURI(e),document.getElementById("qr_container").innerHTML="<img src='https://chart.googleapis.com/chart?chs=200x200&cht=qr&chl="+window.location.protocol+"//"+window.location.host+"/m/"+T+"&choe=UTF-8&chld=L%7C1' alt='qr' />",document.getElementById("qr_container").style.opacity=1,$("#link_join").html("Join link: "+window.location.protocol+"//"+window.location.host+"/m/<span id='join_id'>"+T+"</span>")}),L.emit("host"),window.addEventListener("load",function(){p.volume=.2,$(".button-collapse").sideNav({menuWidth:300}),$("#thing").on("click",function(){}),$("#check-count").on("change",function(){w=this.checked,val=w?"visible":"hidden"}),$("#show-score").on("change",function(){E=this.checked,E?$(".scoreboard-container").removeClass("invisible"):$(".scoreboard-container").hasClass("invisible")||$(".scoreboard-container").addClass("invisible")}),$("#fair-game").on("change",function(){y=!y}),$("#sound").on("change",function(){k=!k}),document.getElementById("playerform").addEventListener("submit",function(e){e.preventDefault(),n(this)}),$(document).on("click",".player-remove-name",function(n){n.preventDefault();var t=parseInt(this.id.split("-")[1]);if(h.length>1&&g.length>1&&!$("#score-"+t).hasClass("remove-left")){var o=$("#score-"+t).next();o.animate({marginTop:"-22px"},400,"linear",function(){}),h=e(h,t),g=e(g,t),$("#score-"+t).addClass("remove-left"),delete C[t],delete M[t];var a=N.find(function(e){return void 0!==e&&e.id===t});N.splice(N.indexOf(a),1),setTimeout(function(){o.css("margin-top","0px"),$("#score-"+t).remove()},500)}else $("#score-"+t).hasClass("remove-left")||($(".toast").remove(),Materialize.toast("You can't delete a player when that player is the only possible next drinker..!",3e3))})}),$(document).on("click","#toast-container",function(){$(this).fadeOut(function(){$(this).remove()})});var H=0;!function(e){e.fn.outerHTML=function(){return e(this).clone().wrap("<div></div>").parent().html()}}(jQuery)}();