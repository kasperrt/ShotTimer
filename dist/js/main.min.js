!function(){function e(e,t){return e.filter(function(e){return e!==t})}function t(){w.postMessage("parent","https://zoff.me"),setTimeout(function(){w.postMessage("get_info","https://zoff.me")},1e3)}function n(e){"np"==e.data.type?($("#now_playing_title").text(e.data.title),$(".now_playing").removeClass("hide"),""!=e.data.title&&void 0!=e.data.title||(clearTimeout(v),v=setTimeout(function(){console.log("trying again"),w.postMessage("get_info","https://zoff.me")},1e3))):"duration"==e.data.type?$(".durationBar").css("width",e.data.percent+1+"vw"):"nextVideo"==e.data.type?($("#next_title").text(e.data.title),$(".now_playing").removeClass("hide")):"controller"==e.data.type&&($(".controller-container").removeClass("hide"),$("#controller_id").html(e.data.id.toUpperCase()))}function o(e){if(name=e.name.value,""!=name&&" "!=name&&"  "!=name&&"   "!=name){e.drawing&&(D[H]=e.drawing),b.push(H),y.push(H),y.push(H),y.push(H),L[H]=h(name),!p&&b.length>0&&($(".scoreboard").empty(),dateNow=new Date,c(),p=window.setInterval(a,1));var t="";e.drawing&&(t="<canvas id='canvas-"+H+"' class='player-icon' height=\""+D[H][3]+'" width="'+D[H][4]+'"></canvas>'),$(".scoreboard").append('<li id="score-'+H+'" title="Click to remove the player" class="score-element player-remove-name">'+t+'<span class="name">'+h(name)+'</span><span class="score">0</span></li>'),e.drawing&&(context=document.getElementById("canvas-"+H).getContext("2d"),d(D[H][0],D[H][1],D[H][2],D[H][5],!0,50)),P[H]={},P[H].id=H,P[H].score=0,P[H].html='<li id="score-'+H+'" title="Click to remove the player" class="score-element player-remove-name">'+t+'<span class="name">'+h(name)+'</span><span class="score">0</span></li>',H+=1,e.name.value=""}else alert("Please enter a name..")}function a(){if(curr=new Date,seconds=Math.floor((fDate-curr)/1e3)-60*Math.floor((fDate-curr)/1e3/60),minutes=Math.floor((fDate-curr)/1e3/60),milli=fDate-curr-1e3*seconds-60*minutes*1e3,0==minutes&&seconds<10||k?document.getElementById("display-area").style.cssText="visibility:visible;":minutes>0&&(document.getElementById("display-area").style.cssText="visibility:hidden;"),minutes<0&&(c(),rng=f(_?y:b),document.getElementById("previous").innerHTML="Your turn to drink "+L[rng]+"!",E=L[y[rng]],r(),responsiveVoice.speak("Your turn to drink "+L[rng],"US English Male",{onend:i}),$("#canvas").remove(),D[rng]&&($("#container").append("<canvas id='canvas' style='-webkit-animation: animation-"+(N?"right":"left")+" "+60*T+"s linear infinite;animation: animation-"+(N?"right":"left")+" "+60*T+"s linear infinite;' height=\""+D[y[rng]][3]+'" width="'+D[y[rng]][4]+'"></canvas>'),N=!N,context=document.getElementById("canvas").getContext("2d"),d(D[rng][0],D[rng][1],D[rng][2],D[rng][5],!0,5)),P.find(function(e){return e.id===rng}).score+=1,P.sort(u({name:"score",reverse:!0})),m(P),_)){var e=y.indexOf(rng);if(y.splice(e,1),0==y.length)for(x in b)y.push(b[x]),y.push(b[x]),y.push(b[x])}document.getElementById("display-area").innerHTML=g(minutes,2)+":"+g(seconds,2)+"."+g(milli,3)}function i(){responsiveVoice.cancel(),s();var e=Math.floor(1e3*Math.random()+1);I&&(137==e?M.play():C.play()),U=0,setTimeout(l,1),setTimeout(function(){document.getElementById("previous").innerHTML="Previous drinker: "+E,U=7,I&&(137==e?(M.pause(),M.currentTime=0):(C.pause(),C.currentTime=0)),document.getElementById("container").style.background="rgba(255,255,255,0.95)"},1e4)}function r(){void 0!==w&&w&&w.postMessage("lower","https://zoff.me")}function s(){void 0!==w&&w&&w.postMessage("reset","https://zoff.me")}function c(){dateNow=new Date,$(".scoreboard-container").removeClass("hide"),$("#interval").prop("checked")?(T=parseInt($("#intervalnumber").val()),T<=0&&(T=1),fDate=new Date(dateNow.getYear()+1900,dateNow.getMonth(),dateNow.getDate(),dateNow.getHours(),dateNow.getMinutes()+T,dateNow.getSeconds(),dateNow.getMilliseconds())):(T=Math.floor(6*Math.random())+1,fDate=new Date(dateNow.getYear()+1900,dateNow.getMonth(),dateNow.getDate(),dateNow.getHours(),dateNow.getMinutes()+T,dateNow.getSeconds(),dateNow.getMilliseconds()))}function l(){U+=1,1==U&&(document.getElementById("container").style.backgroundColor="red",setTimeout(l,85)),2==U&&(document.getElementById("container").style.backgroundColor="blue",setTimeout(l,80)),3==U&&(document.getElementById("container").style.backgroundColor="purple",setTimeout(l,75)),4==U&&(document.getElementById("container").style.backgroundColor="yellow",setTimeout(l,75)),5==U&&(document.getElementById("container").style.backgroundColor="green",setTimeout(l,75)),6==U&&(U=0,setTimeout(l,1))}function d(e,t,n,o,a,i){if(context.strokeStyle=o,context.lineJoin="round",context.lineWidth=i,a)for(var r=0;r<e.length;r++)context.beginPath(),n[r]&&r?context.moveTo(e[r-1],t[r-1]):context.moveTo(e[r]-1,t[r]),context.lineTo(e[r],t[r]),context.closePath(),context.stroke();else context.beginPath(),n[n.length-1]?context.moveTo(e[n.length-2],t[n.length-2]):context.moveTo(e[n.length-1]-1,t[n.length-1]),context.lineTo(e[n.length-1],t[n.length-1]),context.closePath(),context.stroke()}function u(){for(var e,t,n,o=[],a=arguments.length,i=function(e,t){return e===t?0:e<t?-1:1},r=function(e,t){var n=i,o=i;return e&&(o=function(t,o){return n(e(t),e(o))}),t?function(e,t){return-1*o(e,t)}:o},s=0;s<a;s++)e=arguments[s],"string"==typeof e?(t=e,n=i):(t=e.name,n=r(e.primer,e.reverse)),o.push({name:t,cmp:n});return function(t,n){for(var i,r,s=0;s<a&&(r=0,e=o[s],i=e.name,0===(r=e.cmp(t[i],n[i])));s++);return r}}function m(e){$(".scoreboard").empty(),$.each(e,function(e,t){var n=$(t.html),o=t.score;n.find(".score").text(o);var a=n.find("canvas").attr("id");if($(".scoreboard").append(n),void 0!=a){var i=a.split("-")[1];context=document.getElementById("canvas-"+i).getContext("2d"),d(D[i][0],D[i][1],D[i][2],D[i][5],!0,50)}})}function f(e){return e[Math.floor(Math.random()*e.length)]}function g(e,t){return 2==t?out=e<10?"0"+e:e:3==t&&(out=e<10?"00"+e:e<100?"0"+e:e),out}function h(e){return e.charAt(0).toUpperCase()+e.slice(1)}var p,p,v,w,y=Array(),b=Array(),C=new Audio("sound/bell.mp3"),M=new Audio("sound/sanic.mp3"),T=0,k=!0,_=!0,E="",I=!0,B="",D={},N=!0,z=!0,L={},H=0,P=[],A=io(window.location.protocol+"//"+window.location.host+":3000");A.on("joined",function(e){o({name:{value:e._name},drawing:e._drawing})}),A.on("id",function(e){B=encodeURI(e),document.getElementById("qr_container").innerHTML="<img src='https://chart.googleapis.com/chart?chs=200x200&cht=qr&chl="+window.location.protocol+"//"+window.location.host+"/m/"+B+"&choe=UTF-8&chld=L%7C1' alt='qr' />",document.getElementById("qr_container").style.opacity=1,$("#link_join").html("Join link: "+window.location.protocol+"//"+window.location.host+"/m/<span id='join_id'>"+B+"</span>")}),A.emit("host"),window.addEventListener("load",function(){M.volume=.2,$(".button-collapse").sideNav({menuWidth:300}),$("#thing").on("click",function(){}),$("#check-count").on("change",function(){k=this.checked,val=k?"visible":"hidden"}),$("#show-score").on("change",function(){z=this.checked,z?$(".scoreboard-container").removeClass("invisible"):$(".scoreboard-container").hasClass("invisible")||$(".scoreboard-container").addClass("invisible")}),$("#fair-game").on("change",function(){_=!_}),$("#sound").on("change",function(){I=!I}),$("#zofform").on("submit",function(e){e.preventDefault();var n=$("#zoffchannel").val();$("#zoffchannel").val(""),""==n?$("#iframe_container").html(""):(window.postMessageZoff=t,$("#iframe_container").html("<iframe id='iframe' src='https://zoff.me/_embed#"+n+"&71C387&autoplay&videoonly&controll' onload='postMessageZoff()'></iframe>"),w=document.getElementById("iframe").contentWindow,$("#zofform").toggleClass("hide"),$(".stop_zoff").toggleClass("hide"),$(".controller-container").toggleClass("hide")),document.getElementById("inp").focus()}),$(".stop_zoff").on("click",function(e){e.preventDefault(),$("#iframe_container").html(""),$(".stop_zoff").toggleClass("hide"),$("#zofform").toggleClass("hide"),$(".now_playing").hasClass("hide")||$(".now_playing").addClass("hide"),$(".controller-container").hasClass("hide")||($(".controller-container").addClass("hide"),$("#controller_id").html("")),$(".durationBar").css("width","0vw"),delete w,w=!1}),document.getElementById("playerform").addEventListener("submit",function(e){e.preventDefault(),o(this)}),$(document).on("click",".player-remove-name",function(t){t.preventDefault();var n=parseInt(this.id.split("-")[1]);if(y.length>1&&b.length>1&&!$("#score-"+n).hasClass("remove-left")){var o=$("#score-"+n).next();o.animate({marginTop:"-22px"},400,"linear",function(){}),y=e(y,n),b=e(b,n),$("#score-"+n).addClass("remove-left"),delete L[n],delete D[n];var a=P.find(function(e){return void 0!==e&&e.id===n});P.splice(P.indexOf(a),1),setTimeout(function(){o.css("margin-top","0px"),$("#score-"+n).remove()},500)}else $("#score-"+n).hasClass("remove-left")||($(".toast").remove(),Materialize.toast("You can't delete a player when that player is the only possible next drinker..!",3e3))}),window.addEventListener("message",n,!1)}),$(document).on("click","#toast-container",function(){$(this).fadeOut(function(){$(this).remove()})});var U=0;!function(e){e.fn.outerHTML=function(){return e(this).clone().wrap("<div></div>").parent().html()}}(jQuery)}();